<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pakistan Floods 2025 - Interactive Map</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .toggle-btn, .save-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .toggle-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238, 90, 82, 0.4);
        }
        
        .toggle-btn:not(.active) {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .save-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toggle-btn:hover, .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .save-btn:hover {
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .map-container {
            position: relative;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .capture-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 20px;
            margin: 0 auto;
            max-width: 1000px;
        }
        
        .pakistan-map-svg {
            width: 100%;
            max-width: 1000px;
            height: auto;
            display: block;
        }
        
        .province-path {
            stroke: rgba(255, 255, 255, 0.8);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        .province-path:hover {
            stroke: rgba(255, 255, 255, 1);
            stroke-width: 3;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
            transform: scale(1.02);
            transform-origin: center;
        }
        
        /* Deaths view colors */
        .deaths-view .very-high { fill: #8B0000; }
        .deaths-view .high { fill: #FF4500; }
        .deaths-view .medium { fill: #FF8C00; }
        .deaths-view .low { fill: #32CD32; }
        
        /* Destruction view colors */
        .destruction-view .very-high { fill: #4B0082; }
        .destruction-view .high { fill: #FF1493; }
        .destruction-view .medium { fill: #1E90FF; }
        .destruction-view .low { fill: #20B2AA; }
        
        .province-label {
            fill: white;
            font-family: 'Segoe UI', sans-serif;
            font-weight: 700;
            font-size: 14px;
            text-anchor: middle;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
            pointer-events: none;
            user-select: none;
        }
        
        .province-data {
            fill: rgba(255, 255, 255, 0.95);
            font-family: 'Segoe UI', sans-serif;
            font-weight: 500;
            font-size: 11px;
            text-anchor: middle;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.9);
            pointer-events: none;
            user-select: none;
        }
        
        .map-legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            min-width: 200px;
        }
        
        .map-legend h3 {
            margin: 0 0 15px 0;
            font-size: 1.1em;
            text-align: center;
            color: #fff;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .legend-color {
            width: 25px;
            height: 15px;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        
        .stats-panel {
            position: fixed;
            top: 50%;
            left: -400px;
            transform: translateY(-50%);
            width: 350px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 0 20px 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: left 0.4s ease;
            z-index: 100;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .stats-panel.show {
            left: 0;
        }
        
        .stats-panel h2 {
            margin: 0 0 20px 0;
            color: #ff6b6b;
            font-size: 1.5em;
        }
        
        .stat-item {
            margin: 15px 0;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .summary-cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 20px;
            flex-wrap: wrap;
        }
        
        .summary-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 150px;
        }
        
        .summary-card h3 {
            margin: 0 0 10px 0;
            font-size: 2em;
            color: #ff6b6b;
        }
        
        .summary-card p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            transform: translateY(-100px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .save-status.show {
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .map-legend { 
                position: relative; 
                margin: 20px auto; 
                right: auto;
                top: auto;
            }
            .stats-panel { width: 90vw; left: -90vw; }
            .stats-panel.show { left: 0; }
            .controls { margin: 10px; }
            .toggle-btn, .save-btn { padding: 10px 20px; font-size: 14px; }
            .province-label { font-size: 11px; }
            .province-data { font-size: 9px; }
        }

        @keyframes pulse {
            0% { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)) brightness(1); }
            50% { filter: drop-shadow(0 4px 8px rgba(139,0,0,0.8)) brightness(1.3); }
            100% { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)) brightness(1); }
        }
    </style>
</head>
<body>
    <div class="save-status" id="saveStatus">Map saved successfully!</div>
    
    <div class="header">
        <h1>🌊 Pakistan Floods 2025</h1>
        <p>Interactive Province-wise Impact Analysis</p>
    </div>
    
    <div class="summary-cards">
        <div class="summary-card">
            <h3>650+</h3>
            <p>Total Deaths</p>
        </div>
        <div class="summary-card">
            <h3>880+</h3>
            <p>Total Injuries</p>
        </div>
        <div class="summary-card">
            <h3>4</h3>
            <p>Provinces Affected</p>
        </div>
        <div class="summary-card">
            <h3>1,300+</h3>
            <p>People Evacuated</p>
        </div>
    </div>
    
    <div class="controls">
        <button class="toggle-btn active" onclick="showDeaths()">💀 Deaths & Casualties</button>
        <button class="toggle-btn" onclick="showDestruction()">🏠 Infrastructure Damage</button>
        <button class="save-btn" onclick="saveMapAsPNG()">
            📸 Save Map as PNG
        </button>
    </div>
    
    <div class="map-container">
        <div class="capture-area" id="captureArea">
            <svg class="pakistan-map-svg deaths-view" id="pakistanMap" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                <!-- Balochistan -->
                <path class="province-path low" data-province="balochistan" onclick="showStats('balochistan')"
                      d="M50,200 L50,450 L280,480 L320,420 L350,380 L320,320 L280,280 L250,240 L200,220 L150,200 Z"/>
                
                <!-- Sindh -->
                <path class="province-path medium" data-province="sindh" onclick="showStats('sindh')"
                      d="M280,480 L280,380 L380,360 L420,380 L450,420 L430,460 L400,480 L350,490 Z"/>
                
                <!-- Punjab -->
                <path class="province-path high" data-province="punjab" onclick="showStats('punjab')"
                      d="M320,320 L350,280 L420,260 L480,280 L520,320 L500,360 L450,380 L420,380 L380,360 L350,340 Z"/>
                
                <!-- Khyber Pakhtunkhwa -->
                <path class="province-path very-high" data-province="kpk" onclick="showStats('kpk')"
                      d="M200,80 L280,60 L350,80 L420,100 L450,140 L480,180 L500,220 L480,260 L420,260 L350,280 L320,320 L280,280 L250,240 L220,200 L200,160 L180,120 Z"/>
                
                <!-- Gilgit-Baltistan -->
                <path class="province-path low" data-province="gilgit" onclick="showStats('gilgit')"
                      d="M350,80 L420,60 L480,50 L520,60 L550,80 L560,120 L540,140 L520,160 L500,180 L480,180 L450,140 L420,100 Z"/>
                
                <!-- Azad Kashmir -->
                <path class="province-path low" data-province="ajk" onclick="showStats('ajk')"
                      d="M500,220 L530,200 L550,220 L560,240 L550,260 L530,280 L520,320 L500,300 L480,280 L480,260 Z"/>
                
                <!-- Islamabad (small circle) -->
                <circle class="province-path medium" data-province="islamabad" onclick="showStats('islamabad')"
                        cx="480" cy="240" r="15"/>
                
                <!-- Province labels -->
                <text class="province-label" x="180" y="340">BALOCHISTAN</text>
                <text class="province-data" x="180" y="355" id="balochistan-label">4+ Deaths</text>
                
                <text class="province-label" x="360" y="430">SINDH</text>
                <text class="province-data" x="360" y="445" id="sindh-label">7+ Deaths</text>
                
                <text class="province-label" x="420" y="320">PUNJAB</text>
                <text class="province-data" x="420" y="335" id="punjab-label">123+ Deaths</text>
                
                <text class="province-label" x="300" y="170">KHYBER</text>
                <text class="province-label" x="300" y="185">PAKHTUNKHWA</text>
                <text class="province-data" x="300" y="200" id="kpk-label">323+ Deaths</text>
                
                <text class="province-label" x="480" y="115">GILGIT-</text>
                <text class="province-label" x="480" y="130">BALTISTAN</text>
                <text class="province-data" x="480" y="145" id="gilgit-label">Minimal</text>
                
                <text class="province-label" x="530" y="250">AJK</text>
                <text class="province-data" x="530" y="265" id="ajk-label">Minimal</text>
                
                <text class="province-label" x="480" y="225">ICT</text>
                <text class="province-data" x="480" y="260" id="islamabad-label">Alert</text>
            </svg>
            
            <div class="map-legend" id="legend">
                <h3>Deaths Impact Level</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background: #8B0000;"></div>
                    <span>Very High (300+)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF4500;"></div>
                    <span>High (100-300)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF8C00;"></div>
                    <span>Medium (10-100)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #32CD32;"></div>
                    <span>Low (0-10)</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="stats-panel" id="statsPanel">
        <button class="close-btn" onclick="hideStats()">✕</button>
        <h2 id="statsTitle">Province Details</h2>
        <div id="statsContent"></div>
    </div>

    <!-- Include html2canvas library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        let currentView = 'deaths';
        
        const provinceData = {
            balochistan: {
                name: 'Balochistan Province',
                deaths: '4+ (early data)',
                injuries: 'Minimal reported',
                infrastructure: 'Limited damage reported',
                evacuation: 'Some displacement',
                emergency: 'Low alert status',
                keyAreas: ['Quetta vicinity', 'Northern districts'],
                severity: 'low',
                area: '347,190 km² (largest province)',
                population: '12.3 million',
                floodRisk: 'Historically moderate flood risk'
            },
            sindh: {
                name: 'Sindh Province',
                deaths: '7+ (early data)',
                injuries: 'Limited reporting',
                infrastructure: 'Historically most affected (70% damages in 2022)',
                evacuation: 'Precautionary measures',
                emergency: 'Monitoring ongoing',
                keyAreas: ['Coastal regions', 'Karachi suburbs'],
                severity: 'medium',
                area: '140,914 km²',
                population: '47.9 million',
                floodRisk: 'Very high - most vulnerable province'
            },
            punjab: {
                name: 'Punjab Province',
                deaths: '123+ (second highest)',
                injuries: '290+ (in 24 hours alone)',
                infrastructure: '120+ homes damaged, 6 livestock killed',
                evacuation: 'Thousands displaced',
                emergency: 'Section 144 imposed province-wide',
                keyAreas: ['Chakwal (400mm rain in 10hrs)', 'Rawalpindi (flood alert)'],
                severity: 'high',
                area: '205,344 km²',
                population: '110 million (most populous)',
                floodRisk: 'High during monsoon season'
            },
            kpk: {
                name: 'Khyber Pakhtunkhwa',
                deaths: '323+ (highest casualties)',
                injuries: '150+ in Chositi village alone',
                infrastructure: 'Severe damage, military helicopter crash during rescue',
                evacuation: '1,300 tourists evacuated from Mansehra district',
                emergency: 'National mourning declared, state of emergency',
                keyAreas: ['Buner District', 'Mansehra', 'Bajaur', 'Chositi village'],
                severity: 'very-high',
                area: '101,741 km²',
                population: '35.5 million',
                floodRisk: 'Extreme - flash floods from Swat River'
            },
            gilgit: {
                name: 'Gilgit-Baltistan',
                deaths: 'No major casualties reported',
                injuries: 'None reported',
                infrastructure: 'Minimal impact, tourism areas monitored',
                evacuation: 'Precautionary measures only',
                emergency: 'Normal operational status',
                keyAreas: ['Mountain regions', 'Tourist destinations', 'K2 base camp routes'],
                severity: 'low',
                area: '72,971 km²',
                population: '1.8 million',
                floodRisk: 'Low - mountainous terrain, glacial melt concerns'
            },
            ajk: {
                name: 'Azad Jammu & Kashmir',
                deaths: 'No major casualties',
                injuries: 'None reported',
                infrastructure: 'Limited impact',
                evacuation: 'None required',
                emergency: 'Normal status',
                keyAreas: ['Muzaffarabad', 'Border regions with India'],
                severity: 'low',
                area: '13,297 km²',
                population: '4.0 million',
                floodRisk: 'Moderate - river systems'
            },
            islamabad: {
                name: 'Islamabad Capital Territory',
                deaths: 'No casualties reported',
                injuries: 'None reported',
                infrastructure: 'Federal coordination hub, NDMA headquarters',
                evacuation: 'Not required',
                emergency: 'Federal disaster response coordination center',
                keyAreas: ['NDMA headquarters', 'Federal response coordination', 'Diplomatic area'],
                severity: 'medium',
                area: '906 km² (smallest)',
                population: '2.0 million',
                floodRisk: 'Low - planned city with drainage'
            }
        };
        
        function showDeaths() {
            currentView = 'deaths';
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const map = document.querySelector('.pakistan-map-svg');
            map.className = 'pakistan-map-svg deaths-view';
            
            // Update labels
            document.getElementById('balochistan-label').textContent = '4+ Deaths';
            document.getElementById('sindh-label').textContent = '7+ Deaths';
            document.getElementById('punjab-label').textContent = '123+ Deaths';
            document.getElementById('kpk-label').textContent = '323+ Deaths';
            document.getElementById('gilgit-label').textContent = 'Minimal';
            document.getElementById('ajk-label').textContent = 'Minimal';
            document.getElementById('islamabad-label').textContent = 'Alert';
            
            updateLegend('deaths');
            setTimeout(addPulseAnimation, 100);
        }
        
        function showDestruction() {
            currentView = 'destruction';
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const map = document.querySelector('.pakistan-map-svg');
            map.className = 'pakistan-map-svg destruction-view';
            
            // Update labels
            document.getElementById('balochistan-label').textContent = 'Limited';
            document.getElementById('sindh-label').textContent = 'Historic Risk';
            document.getElementById('punjab-label').textContent = '120+ Homes';
            document.getElementById('kpk-label').textContent = 'Severe Damage';
            document.getElementById('gilgit-label').textContent = 'Minimal';
            document.getElementById('ajk-label').textContent = 'Minimal';
            document.getElementById('islamabad-label').textContent = 'Coordination';
            
            updateLegend('destruction');
            // Remove pulse animation in destruction view
            const kpkPath = document.querySelector('[data-province="kpk"]');
            if (kpkPath) {
                kpkPath.style.animation = 'none';
            }
        }
        
        function updateLegend(view) {
            const legend = document.getElementById('legend');
            if (view === 'deaths') {
                legend.innerHTML = `
                    <h3>Deaths Impact Level</h3>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8B0000;"></div>
                        <span>Very High (300+)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF4500;"></div>
                        <span>High (100-300)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF8C00;"></div>
                        <span>Medium (10-100)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #32CD32;"></div>
                        <span>Low (0-10)</span>
                    </div>
                `;
            } else {
                legend.innerHTML = `
                    <h3>Infrastructure Damage</h3>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4B0082;"></div>
                        <span>Severe Damage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF1493;"></div>
                        <span>High (100+ homes)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #1E90FF;"></div>
                        <span>Moderate Impact</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #20B2AA;"></div>
                        <span>Minimal Damage</span>
                    </div>
                `;
            }
        }

        async function saveMapAsPNG() {
            try {
                const captureArea = document.getElementById('captureArea');
                const saveBtn = document.querySelector('.save-btn');
                const originalText = saveBtn.innerHTML;
                
                // Update button to show loading
                saveBtn.innerHTML = '⏳ Capturing...';
                saveBtn.disabled = true;

                // Configure html2canvas options for better quality
                const canvas = await html2canvas(captureArea, {
                    backgroundColor: '#1e3c72',
                    scale: 2, // Higher resolution
                    useCORS: true,
                    allowTaint: true,
                    imageTimeout: 0,
                    removeContainer: false,
                    width: captureArea.offsetWidth,
                    height: captureArea.offsetHeight
                });

                // Create download link
                const link = document.createElement('a');
                const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                const filename = `Pakistan_Floods_2025_${currentView}_${timestamp}.png`;
                
                link.download = filename;
                link.href = canvas.toDataURL('image/png', 1.0);
                
                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Show success message
                showSaveStatus();
                
                // Reset button
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;

            } catch (error) {
                console.error('Error saving map:', error);
                alert('Error saving map. Please try again.');
                
                // Reset button
                const saveBtn = document.querySelector('.save-btn');
                saveBtn.innerHTML = '📸 Save Map as PNG';
                saveBtn.disabled = false;
            }
        }

        function showSaveStatus() {
            const status = document.getElementById('saveStatus');
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }
        
        function showStats(province) {
            const data = provinceData[province];
            const panel = document.getElementById('statsPanel');
            const title = document.getElementById('statsTitle');
            const content = document.getElementById('statsContent');
            
            title.textContent = data.name;
            content.innerHTML = `
                <div class="stat-item">
                    <div class="stat-label">Deaths</div>
                    <div class="stat-value">${data.deaths}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Injuries</div>
                    <div class="stat-value">${data.injuries}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Infrastructure Impact</div>
                    <div class="stat-value">${data.infrastructure}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Evacuation Status</div>
                    <div class="stat-value">${data.evacuation}</div>
